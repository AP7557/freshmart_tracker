(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[152],{278:(e,t,a)=>{"use strict";a.d(t,{r:()=>i});var s=a(5155),r=a(5695),l=a(2528),n=a(2115);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return function(a){let i=(0,r.useRouter)(),{user:d,loading:o}=(0,l.A)();return((0,n.useEffect)(()=>{o||d||i.push("/login"),!o&&d&&t.length>0&&!t.includes(d.role)&&i.push("/addTransactions")},[d,o,i]),o||!d)?(0,s.jsx)("div",{children:"Loading..."}):t.length>0&&!t.includes(d.role)?(0,s.jsx)("div",{children:"Unauthorized"}):(0,s.jsx)(e,{...a,user:d})}}},1841:(e,t,a)=>{Promise.resolve().then(a.bind(a,3227))},2528:(e,t,a)=>{"use strict";a.d(t,{A:()=>c,O:()=>o});var s=a(5155),r=a(2115),l=a(9670),n=a(5317),i=a(6203);let d=(0,r.createContext)();function o(e){let{children:t}=e,[a,o]=(0,r.useState)(null),[c,m]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let e=(0,i.hg)(l.j,async e=>{if(!e){o(null),m(!1);return}try{let t=await (0,n.x7)((0,n.H9)(l.db,"users",e.uid));if(t.exists()){let a=t.data();o({uid:e.uid,email:e.email,...a})}}catch(e){console.error("Error fetching user data:",e)}finally{m(!1)}});return()=>e()},[a]),(0,s.jsx)(d.Provider,{value:{user:a,loading:c,setUser:o},children:t})}function c(){return(0,r.useContext)(d)}},3227:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>D});var s=a(5155),r=a(7525),l=a(2115),n=a(6324),i=a(1145),d=a(4296),o=a(8407),c=a(7976),m=a(6033),u=a(404),x=a(4263),h=a(4311),p=a(9776),y=a(6299),j=a(6962),f=a(3731),g=a(5446),v=a(4235),b=a(9816),N=a(7348),A=a(2664),w=a(6673),S=a(351);let C=e=>{let{setFilteredTransactions:t,sortedTransactions:a,setHasActiveFilters:r}=e,[n,i]=(0,l.useState)({company:"",type:"",dateFilterType:"equal",date:"",dateStart:"",dateEnd:""});(0,l.useEffect)(()=>{(()=>{let{company:e,type:s,dateFilterType:l,date:i,dateStart:d,dateEnd:c}=n,m=""!==e||""!==s||"equal"===l&&""!==i||"range"===l&&(""!==d||""!==c);r(m),t(a.filter(t=>{if(!m)return!0;let a=""===e||t.company.toLowerCase().includes(e.toLowerCase()),r=""===s||t.type.toLowerCase()===s.toLowerCase(),l=o(t);return a&&r&&l}))})()},[n,a]);let d=e=>{if(!e)return null;let t=e.includes("/")?e.split("/"):e.split("-");return 3===t.length?4===t[0].length?new Date(t[0],t[1]-1,t[2]):new Date(t[2],t[0]-1,t[1]):null},o=e=>{let{dateFilterType:t,dateStart:a,dateEnd:s,date:r}=n,l=d(e.date);if(!l)return!1;if("equal"===t){if(!r)return!0;let e=d(r);return e&&l.toDateString()===e.toDateString()}if("range"===t){let e=d(a),t=d(s);if(!e&&!t)return!0;let r=!e||l>=e,n=!t||l<=new Date(t.setHours(23,59,59,999));return r&&n}return!0},c=e=>{let{name:t,value:a}=e.target;i(e=>({...e,[t]:a}))};return(0,s.jsxs)(j.A,{className:"bg-gray-50 p-4 rounded-lg shadow-sm mb-4",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[(0,s.jsx)(f.A,{label:"Search Company",variant:"outlined",size:"small",fullWidth:!0,value:n.company,onChange:e=>i({...n,company:e.target.value}),slotProps:{root:{className:"w-full"},input:{className:"py-2 px-2",startAdornment:(0,s.jsx)(g.A,{position:"start",children:(0,s.jsx)(S.CKj,{className:"text-gray-400"})}),endAdornment:n.company&&(0,s.jsx)(g.A,{position:"end",children:(0,s.jsx)(v.A,{size:"small",onClick:()=>i({...n,company:""}),className:"text-gray-400 hover:text-gray-600",children:(0,s.jsx)(S.yGN,{size:16})})})}}}),(0,s.jsxs)(b.A,{fullWidth:!0,size:"small",children:[(0,s.jsx)(N.A,{children:"Transaction Type"}),(0,s.jsxs)(A.A,{label:"Transaction Type",value:n.type,onChange:e=>i({...n,type:e.target.value}),slotProps:{root:{className:"w-full"}},children:[(0,s.jsx)(w.A,{value:"",children:"All Types"}),(0,s.jsx)(w.A,{value:"Invoice",children:"Invoice"}),(0,s.jsx)(w.A,{value:"Payment",children:"Payment"})]})]}),(0,s.jsxs)(b.A,{fullWidth:!0,size:"small",children:[(0,s.jsx)(N.A,{children:"Date Filter"}),(0,s.jsxs)(A.A,{label:"Date Filter",value:n.dateFilterType,onChange:e=>i({...n,dateFilterType:e.target.value}),slotProps:{root:{className:"w-full"}},children:[(0,s.jsx)(w.A,{value:"equal",children:"Specific Date"}),(0,s.jsx)(w.A,{value:"range",children:"Date Range"})]})]})]}),(0,s.jsx)("div",{className:"flex flex-col md:flex-row gap-4",children:"equal"===n.dateFilterType?(0,s.jsx)(f.A,{label:"Select Date",type:"date",size:"small",fullWidth:!0,value:n.date,onChange:c,name:"date",slotProps:{inputLabel:{shrink:!0},input:{className:"py-2",endAdornment:n.date&&(0,s.jsx)(g.A,{position:"end",children:(0,s.jsx)(v.A,{size:"small",onClick:()=>i({...n,date:""}),className:"text-gray-400 hover:text-gray-600",children:(0,s.jsx)(S.yGN,{size:16})})})}}}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.A,{label:"Start Date",type:"date",size:"small",fullWidth:!0,value:n.dateStart,onChange:c,name:"dateStart",slotProps:{inputLabel:{shrink:!0},input:{className:"py-2"}}}),(0,s.jsx)(f.A,{label:"End Date",type:"date",size:"small",fullWidth:!0,value:n.dateEnd,onChange:c,name:"dateEnd",slotProps:{inputLabel:{shrink:!0},input:{className:"py-2"}}})]})}),(n.company||n.type||n.date||n.dateStart||n.dateEnd)&&(0,s.jsx)("div",{className:"flex justify-end mt-2",children:(0,s.jsxs)("button",{onClick:()=>{i({company:"",type:"",dateFilterType:"equal",date:"",dateStart:"",dateEnd:""})},className:"text-sm text-primary-600 hover:text-primary-800 font-medium flex items-center",children:[(0,s.jsx)(S.yGN,{size:14,className:"mr-1"}),"Clear all filters"]})})]})},P=e=>{let{allTransactionsForEachStore:t,storeSelected:a}=e,r=(0,n.A)(),j=(0,i.A)(r.breakpoints.down("sm")),[f,g]=(0,l.useState)(0),[v,b]=(0,l.useState)("desc"),[N,A]=(0,l.useState)("date"),[w,S]=(0,l.useState)([]),[P,E]=(0,l.useState)([]),[D,I]=(0,l.useState)(!1),k=()=>{let e=t.find(e=>e.store===a);return e?e.transactions.map((e,t)=>({...e,id:"".concat(a,"-").concat(t)})):[]},T=e=>[...e].sort((e,t)=>{if("company"===N)return"asc"===v?e.company.localeCompare(t.company):t.company.localeCompare(e.company);if("amount"===N)return"asc"===v?e.amount-t.amount:t.amount-e.amount;if("date"===N){let a=new Date(e.date),s=new Date(t.date);return"asc"===v?a-s:s-a}return 0});(0,l.useEffect)(()=>{let e=k(),t=T(D?w:e);E(t),D||S(t)},[a,v,N,D]);let F=e=>{b(N===e&&"asc"===v?"desc":"asc"),A(e)};return(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:[(0,s.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-800",children:"Transaction History"})}),(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)(C,{setFilteredTransactions:S,sortedTransactions:P,setHasActiveFilters:I})}),!j&&(0,s.jsx)(d.A,{component:o.A,elevation:0,children:(0,s.jsxs)(c.A,{children:[(0,s.jsx)(m.A,{children:(0,s.jsxs)(u.A,{className:"bg-gray-50",children:[(0,s.jsx)(x.A,{children:(0,s.jsx)(h.A,{active:"company"===N,direction:"company"===N?v:"asc",onClick:()=>F("company"),children:(0,s.jsx)("span",{className:"font-semibold",children:"Company"})})}),(0,s.jsx)(x.A,{children:(0,s.jsx)(h.A,{active:"amount"===N,direction:"amount"===N?v:"asc",onClick:()=>F("amount"),children:(0,s.jsx)("span",{className:"font-semibold",children:"Amount"})})}),(0,s.jsx)(x.A,{children:(0,s.jsx)("span",{className:"font-semibold",children:"Type"})}),(0,s.jsx)(x.A,{children:(0,s.jsx)(h.A,{active:"date"===N,direction:"date"===N?v:"asc",onClick:()=>F("date"),children:(0,s.jsx)("span",{className:"font-semibold",children:"Date"})})})]})}),(0,s.jsx)(p.A,{children:w.slice(5*f,5*f+5).map(e=>(0,s.jsxs)(u.A,{hover:!0,className:"hover:bg-gray-50",children:[(0,s.jsx)(x.A,{children:e.company}),(0,s.jsxs)(x.A,{children:["$",e.amount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")]}),(0,s.jsx)(x.A,{children:(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("Invoice"===e.type?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:e.type})}),(0,s.jsx)(x.A,{children:new Date(e.date).toLocaleDateString()})]},e.id))})]})}),j&&(0,s.jsx)("div",{className:"space-y-3 p-4",children:w.slice(5*f,5*f+5).map(e=>(0,s.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 shadow-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,s.jsx)("span",{className:"font-semibold text-gray-800",children:e.company}),(0,s.jsxs)("span",{className:"font-bold",children:["$",e.amount.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("Invoice"===e.type?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:e.type}),(0,s.jsx)("span",{children:new Date(e.date).toLocaleDateString()})]})]},e.id))}),(0,s.jsx)(y.A,{rowsPerPageOptions:[5],component:"div",count:w.length,rowsPerPage:5,page:f,onPageChange:(e,t)=>{g(t)},className:"border-t border-gray-200"})]})};function E(e){let{storeSelected:t,totalInvoiceLeftToPay:a}=e;return(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:[(0,s.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,s.jsxs)("h3",{className:"text-xl font-semibold text-gray-800",children:["Outstanding Invoices for ",t]})}),(0,s.jsx)("div",{className:"divide-y divide-gray-200",children:(a[t]?Object.entries(a[t]).filter(e=>{let[t,a]=e;return Math.max(0,a.totalInvoice-a.totalPayment)>0}).sort((e,t)=>{let a=Math.max(0,e[1].totalInvoice-e[1].totalPayment);return Math.max(0,t[1].totalInvoice-t[1].totalPayment)-a}):[]).map(e=>{let[t,a]=e,r=Math.max(0,a.totalInvoice-a.totalPayment);return(0,s.jsxs)("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"font-medium text-gray-800",children:t}),(0,s.jsxs)("span",{className:"font-bold text-red-600",children:["$",r.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm text-gray-500 mt-1",children:[(0,s.jsxs)("span",{children:["Invoiced: $",a.totalInvoice.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")]}),(0,s.jsxs)("span",{children:["Paid: $",a.totalPayment.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")]})]})]},t)})})]})}let D=(0,a(278).r)(function(e){var t;let{user:a}=e,[n,i]=(0,l.useState)(""),[d,o]=(0,l.useState)({}),{allTransactionsForEachStore:c}=(0,r.E)();(0,l.useEffect)(()=>{let e={};c.forEach(t=>{let{store:a,transactions:s}=t;s.forEach(t=>{let s=t.company,r=t.amount,l=t.type;e[a]||(e[a]={}),e[a][s]||(e[a][s]={totalPayment:0,totalInvoice:0}),"Payment"===l?e[a][s].totalPayment+=r:"Invoice"===l&&(e[a][s].totalInvoice+=r)})}),o(e)},[c]);let m=e=>d[e]?Object.values(d[e]).reduce((e,t)=>e+Math.max(0,t.totalInvoice-t.totalPayment),0):0;return(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[(0,s.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-8 border-b border-gray-200 pb-4",children:"Store Financial Overview"}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-10",children:null===(t=a.stores)||void 0===t?void 0:t.map((e,t)=>{var a;return(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-md overflow-hidden border-l-4 transition-all duration-200 \n              ".concat(n===e?"border-primary-600 scale-[1.02]":"border-transparent hover:border-gray-300"),onClick:()=>i(e),children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-800",children:e}),(0,s.jsxs)("span",{className:"text-xl font-bold ".concat(m(e)>0?"text-red-600":"text-green-600"),children:["$",m(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")]})]}),(0,s.jsxs)("div",{className:"mt-4 text-sm text-gray-500",children:[(null===(a=c.find(t=>t.store===e))||void 0===a?void 0:a.transactions.length)||0," ","transactions"]})]})},t)})}),n&&(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,s.jsx)(E,{storeSelected:n,totalInvoiceLeftToPay:d}),(0,s.jsx)(P,{allTransactionsForEachStore:c,storeSelected:n})]})]})},["master","manager"])},7525:(e,t,a)=>{"use strict";a.d(t,{M:()=>m,E:()=>c});var s=a(5155),r=a(2115),l=a(9670),n=a(5317);let i=async()=>{try{let e=(0,n.rJ)(l.db,"Lists");return(await (0,n.GG)(e)).docs.map(e=>e.data())}catch(e){return console.error("Error fetching lists: ",e),[]}},d=async e=>{try{let t=e.map(async e=>{let t=(await (0,n.GG)((0,n.rJ)(l.db,e))).docs.map(e=>e.data());return{store:e,transactions:t}});return await Promise.all(t)}catch(e){return console.error("Error fetching transactions: ",e),[]}},o=(0,r.createContext)(),c=()=>(0,r.useContext)(o),m=e=>{let{children:t}=e,[a,l]=(0,r.useState)([]),[n,c]=(0,r.useState)([]),[m,u]=(0,r.useState)([]),[x,h]=(0,r.useState)([]);return(0,r.useEffect)(()=>{(async()=>{let[e,t]=await i("Lists"),a=Object.values(t);c(a),l(Object.values(e));let s=await d(a),r=new Date().toLocaleDateString("en-US"),n=x.map(e=>{let{store:t,transactions:a}=e;return a.filter(e=>e.date===r&&""!==e.date).map(e=>({...e,store:t}))}).flat();h(s),u(n)})()},[a,n]),(0,s.jsx)(o.Provider,{value:{companyList:a,storesList:n,todaysTransactionData:m,addTodaysTransaction:e=>{u(t=>[...t,e])},allTransactionsForEachStore:x},children:t})}},9670:(e,t,a)=>{"use strict";a.d(t,{db:()=>d,j:()=>i});var s=a(3915),r=a(6203),l=a(5317);let n=(0,s.Wp)({apiKey:"AIzaSyBrhGNzC2JEoYMR34bXv2vwMBQPVNl3NG8",authDomain:"freshmart-tracker.firebaseapp.com",projectId:"freshmart-tracker",storageBucket:"freshmart-tracker.firebasestorage.app",messagingSenderId:"36913606146",appId:"1:36913606146:web:5516b95ff654f02a9fc11b",measurementId:"G-MP5V2Y0VX2"}),i=(0,r.xI)(n),d=(0,l.aU)(n)}},e=>{var t=t=>e(e.s=t);e.O(0,[992,158,844,866,47,768,441,684,358],()=>t(1841)),_N_E=e.O()}]);