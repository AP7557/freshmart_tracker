(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7],{278:(e,r,s)=>{"use strict";s.d(r,{r:()=>n});var t=s(5155),a=s(5695),c=s(2528),l=s(2115);function n(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return function(s){let n=(0,a.useRouter)(),{user:d,loading:i}=(0,c.A)();return((0,l.useEffect)(()=>{i||d||n.push("/login"),!i&&d&&r.length>0&&!r.includes(d.role)&&n.push("/addTransactions")},[d,i,n]),i||!d)?(0,t.jsx)("div",{children:"Loading..."}):r.length>0&&!r.includes(d.role)?(0,t.jsx)("div",{children:"Unauthorized"}):(0,t.jsx)(e,{...s,user:d})}}},900:(e,r,s)=>{Promise.resolve().then(s.bind(s,3051))},2528:(e,r,s)=>{"use strict";s.d(r,{A:()=>o,O:()=>i});var t=s(5155),a=s(2115),c=s(9670),l=s(5317),n=s(6203);let d=(0,a.createContext)();function i(e){let{children:r}=e,[s,i]=(0,a.useState)(null),[o,u]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{let e=(0,n.hg)(c.j,async e=>{if(!e){i(null),u(!1);return}try{let r=await (0,l.x7)((0,l.H9)(c.db,"users",e.uid));if(r.exists()){let s=r.data();i({uid:e.uid,email:e.email,...s})}}catch(e){console.error("Error fetching user data:",e)}finally{u(!1)}});return()=>e()},[s]),(0,t.jsx)(d.Provider,{value:{user:s,loading:o,setUser:i},children:r})}function o(){return(0,a.useContext)(d)}},3051:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>m});var t=s(5155),a=s(2115),c=s(5695),l=s(351),n=s(5317),d=s(7525),i=s(9670),o=s(278);let u=["master","manager","user"],m=(0,o.r)(function(e){let{user:r}=e,s=(0,c.useRouter)(),{storesList:o}=(0,d.E)(),[m,x]=(0,a.useState)([]),[g,h]=(0,a.useState)(!0),[f,p]=(0,a.useState)(""),[b,v]=(0,a.useState)("");"master"!==r.role&&s.push("/addTransactions"),(0,a.useEffect)(()=>{(async()=>{try{let e=(0,n.rJ)(i.db,"users"),r=(await (0,n.GG)(e)).docs.map(e=>({id:e.id,...e.data()}));x(r),h(!1)}catch(e){p("Failed to fetch users"),console.error(e)}})()},[]);let j=async(e,r)=>{try{await (0,n.mZ)((0,n.H9)(i.db,"users",e),{role:r}),x(m.map(s=>s.id===e?{...s,role:r}:s)),v("Role updated successfully"),setTimeout(()=>v(""),3e3)}catch(e){p("Failed to update role"),console.error(e)}},y=async(e,r,s)=>{try{let t=m.find(r=>r.id===e).stores||[];t=s?[...t,r]:t.filter(e=>e!==r),await (0,n.mZ)((0,n.H9)(i.db,"users",e),{stores:t}),x(m.map(r=>r.id===e?{...r,stores:t}:r)),v("Store access updated successfully"),setTimeout(()=>v(""),3e3)}catch(e){p("Failed to update store access"),console.error(e)}},N=async(e,r)=>{try{await (0,n.mZ)((0,n.H9)(i.db,"users",e),{canViewOverview:r}),x(m.map(s=>s.id===e?{...s,canViewOverview:r}:s)),v("Overview access updated successfully"),setTimeout(()=>v(""),3e3)}catch(e){p("Failed to update overview access"),console.error(e)}};return g?(0,t.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"})}):(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-4 md:p-6 max-w-6xl mx-auto",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,t.jsx)(l.cfS,{className:"text-green-600 text-2xl"}),(0,t.jsx)("h1",{className:"text-2xl font-semibold text-gray-800",children:"User Management"})]}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:"As a master admin, you can manage user roles and store access."}),f&&(0,t.jsxs)("div",{className:"mb-4 p-4 bg-red-50 text-red-700 rounded-lg border border-red-200 flex items-center gap-2",children:[(0,t.jsx)(l.yGN,{className:"text-red-700"}),f]}),b&&(0,t.jsxs)("div",{className:"mb-4 p-4 bg-green-50 text-green-700 rounded-lg border border-green-200 flex items-center gap-2",children:[(0,t.jsx)(l.YrT,{className:"text-green-700"}),b]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(e=>{var r;return(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-4 pb-4 border-b border-gray-100",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(l.JXP,{className:"text-gray-500"}),(0,t.jsx)("h3",{className:"font-medium text-gray-800",children:e.email})]}),(0,t.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("master"===e.role?"bg-purple-100 text-purple-800":"manager"===e.role?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"),children:e.role})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"text-sm font-medium text-gray-700 mb-1 flex items-center gap-2",children:[(0,t.jsx)(l.pcC,{className:"text-green-600"}),"Role"]}),(0,t.jsx)("select",{value:e.role,onChange:r=>j(e.id,r.target.value),disabled:e.id===(null===(r=i.j.currentUser)||void 0===r?void 0:r.uid),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:u.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"text-sm font-medium text-gray-700 mb-1 flex items-center gap-2",children:[(0,t.jsx)(l.p45,{className:"text-green-600"}),"Store Access"]}),(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:o.map(r=>{var s;return(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",id:"".concat(e.id,"-").concat(r),checked:(null===(s=e.stores)||void 0===s?void 0:s.includes(r))||!1,onChange:s=>y(e.id,r,s.target.checked),className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded"}),(0,t.jsx)("label",{htmlFor:"".concat(e.id,"-").concat(r),className:"ml-2 block text-sm text-gray-700",children:r})]},r)})})]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",id:"".concat(e.id,"-overview"),checked:e.canViewOverview||!1,onChange:r=>N(e.id,r.target.checked),className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded"}),(0,t.jsxs)("label",{htmlFor:"".concat(e.id,"-overview"),className:"ml-2 text-sm text-gray-700 flex items-center gap-2",children:[e.canViewOverview?(0,t.jsx)(l.Vap,{className:"text-green-600"}):(0,t.jsx)(l._NO,{className:"text-gray-500"}),"Can View Overview"]})]})]})]},e.id)})})]})},["master"])},5695:(e,r,s)=>{"use strict";var t=s(8999);s.o(t,"useRouter")&&s.d(r,{useRouter:function(){return t.useRouter}})},7525:(e,r,s)=>{"use strict";s.d(r,{M:()=>u,E:()=>o});var t=s(5155),a=s(2115),c=s(9670),l=s(5317);let n=async()=>{try{let e=(0,l.rJ)(c.db,"Lists");return(await (0,l.GG)(e)).docs.map(e=>e.data())}catch(e){return console.error("Error fetching lists: ",e),[]}},d=async e=>{try{let r=e.map(async e=>{let r=(await (0,l.GG)((0,l.rJ)(c.db,e))).docs.map(e=>e.data());return{store:e,transactions:r}});return await Promise.all(r)}catch(e){return console.error("Error fetching transactions: ",e),[]}},i=(0,a.createContext)(),o=()=>(0,a.useContext)(i),u=e=>{let{children:r}=e,[s,c]=(0,a.useState)([]),[l,o]=(0,a.useState)([]),[u,m]=(0,a.useState)([]),[x,g]=(0,a.useState)([]);return(0,a.useEffect)(()=>{(async()=>{let[e,r]=await n("Lists"),s=Object.values(r);o(s),c(Object.values(e));let t=await d(s),a=new Date().toLocaleDateString("en-US"),l=x.map(e=>{let{store:r,transactions:s}=e;return s.filter(e=>e.date===a&&""!==e.date).map(e=>({...e,store:r}))}).flat();g(t),m(l)})()},[s,l]),(0,t.jsx)(i.Provider,{value:{companyList:s,storesList:l,todaysTransactionData:u,addTodaysTransaction:e=>{m(r=>[...r,e])},allTransactionsForEachStore:x},children:r})}},9670:(e,r,s)=>{"use strict";s.d(r,{db:()=>d,j:()=>n});var t=s(3915),a=s(6203),c=s(5317);let l=(0,t.Wp)({apiKey:"AIzaSyBrhGNzC2JEoYMR34bXv2vwMBQPVNl3NG8",authDomain:"freshmart-tracker.firebaseapp.com",projectId:"freshmart-tracker",storageBucket:"freshmart-tracker.firebasestorage.app",messagingSenderId:"36913606146",appId:"1:36913606146:web:5516b95ff654f02a9fc11b",measurementId:"G-MP5V2Y0VX2"}),n=(0,a.xI)(l),d=(0,c.aU)(l)}},e=>{var r=r=>e(e.s=r);e.O(0,[992,158,844,866,441,684,358],()=>r(900)),_N_E=e.O()}]);